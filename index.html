<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
<title>Weekly Tracker</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0f172a">

<style>
:root{
    --bg: linear-gradient(160deg,#0f172a,#1e293b);
    --card: rgba(255,255,255,0.07);
    --border: rgba(255,255,255,0.12);
    --primary:#6366f1;
    --success:#22c55e;
    --fail:#ef4444;
    --text:#f1f5f9;
}

html,body{
    margin:0;
    padding:0;
    width:100%;
    overflow-x:hidden;
    -webkit-text-size-adjust:100%;
}

*{
    box-sizing:border-box;
    font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
}

body{
    background:var(--bg);
    padding:16px;
    padding-top:calc(16px + env(safe-area-inset-top));
    padding-bottom:calc(20px + env(safe-area-inset-bottom));
    color:var(--text);
}

input,button{ font-size:16px; }

.container{
    width:100%;
    max-width:460px;
    margin:auto;
}

h1{
    text-align:center;
    margin-bottom:20px;
    font-weight:600;
}

.card{
    background:var(--card);
    border:1px solid var(--border);
    border-radius:20px;
    padding:18px;
    margin-bottom:18px;
    backdrop-filter:blur(12px);
    box-shadow:0 15px 35px rgba(0,0,0,0.3);
    animation:fadeIn 0.4s ease;
}

@keyframes fadeIn{
    from{opacity:0; transform:translateY(8px);}
    to{opacity:1; transform:translateY(0);}
}

input[type="text"]{
    width:100%;
    padding:14px;
    border-radius:14px;
    border:1px solid var(--border);
    background:rgba(255,255,255,0.05);
    color:var(--text);
    margin-bottom:18px;
}

.days-selector{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:12px;
    margin-bottom:18px;
}

.days-selector label{
    display:flex;
    align-items:center;
    gap:8px;
}

button{
    width:100%;
    padding:14px;
    border:none;
    border-radius:14px;
    background:var(--primary);
    color:white;
    cursor:pointer;
    transition:0.2s;
}

button:active{ transform:scale(0.97); }

.week-nav{
    display:flex;
    flex-direction:column;
    gap:12px;
    margin-bottom:16px;
}

.week-nav-top{
    display:flex;
    gap:12px;
}

.week-nav-top button{
    flex:1;
    background:rgba(255,255,255,0.1);
    border:1px solid var(--border);
}

.week-nav span{
    text-align:center;
    font-size:14px;
}

.week{
    display:flex;
    flex-direction:column;
    gap:14px;
}

.day{
    border:1px solid var(--border);
    border-radius:16px;
    padding:14px;
    background:rgba(255,255,255,0.04);
}

.day h3{ margin-bottom:10px; }

.task{
    display:flex;
    align-items:center;
    gap:8px;
    margin-bottom:8px;
    transition:0.2s;
}

.task:hover{ transform:translateX(2px); }

.task span{ flex:1; }

.task.done span{
    text-decoration:line-through;
    color:var(--success);
}

.task.failed span{
    text-decoration:line-through;
    color:var(--fail);
}

.task button{
    background:transparent;
    border:1px solid var(--border);
    padding:4px 8px;
    font-size:12px;
    border-radius:8px;
}

.chart-wrapper{
    position:relative;
    width:100%;
    max-width:240px;
    margin:auto;
}

canvas{ width:100%; }

.percentage{
    position:absolute;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    font-size:22px;
    font-weight:600;
}
</style>
</head>

<body>
<div class="container">

<h1>Weekly Tracker</h1>

<div class="card">
<input type="text" id="taskInput" placeholder="Nueva tarea">

<div class="days-selector">
<label><input type="checkbox" value="monday"> Lunes</label>
<label><input type="checkbox" value="tuesday"> Martes</label>
<label><input type="checkbox" value="wednesday"> Miércoles</label>
<label><input type="checkbox" value="thursday"> Jueves</label>
<label><input type="checkbox" value="friday"> Viernes</label>
<label><input type="checkbox" value="saturday"> Sábado</label>
<label><input type="checkbox" value="sunday"> Domingo</label>
</div>

<button id="addTaskBtn">Agregar tarea</button>
</div>

<div class="card">
<div class="week-nav">
<div class="week-nav-top">
<button onclick="app.changeWeek(-1)">Anterior</button>
<button onclick="app.changeWeek(1)">Siguiente</button>
</div>
<span id="weekLabel"></span>
</div>

<div class="week" id="weekContainer"></div>
</div>

<div class="card">
<h3 style="text-align:center;margin-bottom:16px;">Rendimiento semanal</h3>
<div class="chart-wrapper">
<canvas id="statsChart"></canvas>
<div class="percentage" id="percentage">0%</div>
</div>
</div>

</div>

<script>
class App{
constructor(){
this.habits=JSON.parse(localStorage.getItem("habits"))||[];
this.weeklyProgress=JSON.parse(localStorage.getItem("weeklyProgress"))||{};
this.currentDate=new Date();

this.labels={
monday:"Lunes",tuesday:"Martes",wednesday:"Miércoles",
thursday:"Jueves",friday:"Viernes",
saturday:"Sábado",sunday:"Domingo"
};

document.getElementById("addTaskBtn")
.addEventListener("click",()=>this.addHabit());

this.render();
}

getWeekStart(date){
const d=new Date(date);
const day=d.getDay();
const diff=d.getDate()-((day+6)%7);
return new Date(d.setDate(diff));
}

getWeekKey(date){
return this.getWeekStart(date).toDateString();
}

changeWeek(offset){
this.currentDate.setDate(this.currentDate.getDate()+offset*7);
this.render();
}

save(){
localStorage.setItem("habits",JSON.stringify(this.habits));
localStorage.setItem("weeklyProgress",JSON.stringify(this.weeklyProgress));
}

addHabit(){
const input=document.getElementById("taskInput");
const text=input.value.trim();
if(!text)return;

const selected=document.querySelectorAll(".days-selector input:checked");
if(selected.length===0)return;

const id=Date.now().toString();
const days=[...selected].map(cb=>cb.value);

this.habits.push({id,text,days,deletedFrom:null});
selected.forEach(cb=>cb.checked=false);
input.value="";
this.save();
this.render();
}

deleteHabitFromNow(id){
const weekKey=this.getWeekKey(this.currentDate);
const habit=this.habits.find(h=>h.id===id);
habit.deletedFrom=weekKey;
this.save();
this.render();
}

setStatus(habitId,day,status){
const key=this.getWeekKey(this.currentDate);
if(!this.weeklyProgress[key])this.weeklyProgress[key]={};
if(!this.weeklyProgress[key][habitId])this.weeklyProgress[key][habitId]={};
this.weeklyProgress[key][habitId][day]=status;
this.save();
this.render();
}

getStatus(habitId,day){
const key=this.getWeekKey(this.currentDate);
return this.weeklyProgress?.[key]?.[habitId]?.[day]||"pending";
}

isVisible(habit){
if(!habit.deletedFrom)return true;
return this.getWeekKey(this.currentDate)<habit.deletedFrom;
}

stats(){
let done=0,failed=0;
const key=this.getWeekKey(this.currentDate);
const week=this.weeklyProgress[key]||{};
Object.values(week).forEach(days=>{
Object.values(days).forEach(status=>{
if(status==="done")done++;
if(status==="failed")failed++;
});
});
return{done,failed};
}

animatePercentage(target){
const el=document.getElementById("percentage");
let current=0;
const step=()=>{
if(current<=target){
el.innerText=current+"%";
current++;
requestAnimationFrame(step);
}
};
step();
}

drawChart(){
const canvas=document.getElementById("statsChart");
const ctx=canvas.getContext("2d");
const size=canvas.offsetWidth;
canvas.width=size;
canvas.height=size;
ctx.clearRect(0,0,size,size);

const {done,failed}=this.stats();
const total=done+failed;
if(total===0){
this.animatePercentage(0);
return;
}

const percent=Math.round((done/total)*100);
this.animatePercentage(percent);

const doneAngle=(done/total)*Math.PI*2;

ctx.beginPath();
ctx.moveTo(size/2,size/2);
ctx.arc(size/2,size/2,size/2-10,0,doneAngle);
ctx.fillStyle="#22c55e";
ctx.fill();

ctx.beginPath();
ctx.moveTo(size/2,size/2);
ctx.arc(size/2,size/2,size/2-10,doneAngle,Math.PI*2);
ctx.fillStyle="#ef4444";
ctx.fill();
}

render(){
const weekStart=this.getWeekStart(this.currentDate);
const weekEnd=new Date(weekStart);
weekEnd.setDate(weekStart.getDate()+6);

document.getElementById("weekLabel").innerText=
`${weekStart.toLocaleDateString()} - ${weekEnd.toLocaleDateString()}`;

const container=document.getElementById("weekContainer");
container.innerHTML="";

Object.keys(this.labels).forEach(day=>{
const div=document.createElement("div");
div.className="day";
div.innerHTML=`<h3>${this.labels[day]}</h3>`;

this.habits
.filter(h=>h.days.includes(day)&&this.isVisible(h))
.forEach(habit=>{
const status=this.getStatus(habit.id,day);
const t=document.createElement("div");
t.className="task";
if(status==="done")t.classList.add("done");
if(status==="failed")t.classList.add("failed");

t.innerHTML=`
<input type="checkbox" ${status==="done"?"checked":""}>
<input type="checkbox" ${status==="failed"?"checked":""}>
<span>${habit.text}</span>
<button>Eliminar</button>
`;

const checks=t.querySelectorAll("input");
checks[0].addEventListener("change",()=>this.setStatus(habit.id,day,"done"));
checks[1].addEventListener("change",()=>this.setStatus(habit.id,day,"failed"));

t.querySelector("button")
.addEventListener("click",()=>this.deleteHabitFromNow(habit.id));

div.appendChild(t);
});

container.appendChild(div);
});

this.drawChart();
}
}

const app=new App();
</script>

</body>
</html>

