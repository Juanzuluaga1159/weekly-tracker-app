<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
<title>Weekly Tracker</title>

<style>
:root{
--bg:linear-gradient(160deg,#0f172a,#1e293b);
--card:rgba(255,255,255,0.07);
--border:rgba(255,255,255,0.12);
--primary:#6366f1;
--success:#22c55e;
--fail:#ef4444;
--text:#f1f5f9;
}

*{
box-sizing:border-box;
font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
}

body{
margin:0;
background:var(--bg);
padding:16px;
color:var(--text);
}

.container{
max-width:480px;
margin:auto;
}

h1{
text-align:center;
margin-bottom:20px;
font-weight:600;
}

.card{
background:var(--card);
border:1px solid var(--border);
border-radius:20px;
padding:18px;
margin-bottom:18px;
backdrop-filter:blur(12px);
box-shadow:0 10px 30px rgba(0,0,0,0.3);
}

/* INPUT TEXTO */
input[type="text"]{
width:100%;
padding:14px;
border-radius:14px;
border:1px solid var(--border);
background:rgba(255,255,255,0.05);
color:var(--text);
margin-bottom:14px;
}

/* ===== TIME PICKER CUSTOM ===== */

.time-display{
width:100%;
padding:16px;
border-radius:16px;
border:1px solid rgba(99,102,241,.3);
background:rgba(255,255,255,0.05);
text-align:center;
cursor:pointer;
transition:.2s;
margin-bottom:18px;
}

.time-display:hover{
border-color:#8b5cf6;
}

.time-modal{
position:fixed;
inset:0;
background:rgba(0,0,0,.6);
display:none;
align-items:flex-end;
justify-content:center;
z-index:999;
}

.time-picker{
width:100%;
max-width:480px;
background:#1e293b;
border-radius:20px 20px 0 0;
padding:20px;
animation:slideUp .25s ease;
}

@keyframes slideUp{
from{transform:translateY(100%);}
to{transform:translateY(0);}
}

.time-columns{
display:flex;
gap:20px;
height:220px;
margin-bottom:16px;
}

.time-column{
flex:1;
overflow-y:auto;
text-align:center;
}

.time-item{
padding:10px;
border-radius:10px;
cursor:pointer;
transition:.2s;
}

.time-item:hover{
background:rgba(99,102,241,.2);
}

.time-item.active{
background:rgba(99,102,241,.4);
font-weight:bold;
}

/* DIAS */
.days-selector{
display:grid;
grid-template-columns:1fr 1fr;
gap:10px;
margin-bottom:18px;
}

/* BOTONES */
button{
width:100%;
padding:14px;
border:none;
border-radius:14px;
background:linear-gradient(90deg,#6366f1,#8b5cf6);
color:white;
cursor:pointer;
transition:.2s;
}

button:active{ transform:scale(.97); }

/* SEMANA */
.week-nav{
display:flex;
flex-direction:column;
gap:12px;
margin-bottom:16px;
}

.week-nav-top{
display:flex;
gap:12px;
}

.week-nav-top button{
flex:1;
background:rgba(255,255,255,0.08);
border:1px solid var(--border);
}

.week-label{
text-align:center;
font-size:14px;
opacity:.8;
}

/* DIAS */
.week{
display:flex;
flex-direction:column;
gap:14px;
}

.day{
border:1px solid var(--border);
border-radius:16px;
padding:14px;
background:rgba(255,255,255,0.04);
}

.day h3{
margin-bottom:10px;
}

/* TAREA */
.task{
display:flex;
align-items:center;
gap:8px;
margin-bottom:8px;
}

.task span{
flex:1;
}

.time-badge{
font-size:11px;
padding:4px 8px;
border-radius:20px;
background:rgba(99,102,241,.25);
border:1px solid rgba(99,102,241,.4);
}

.delete-btn{
background:transparent;
border:1px solid var(--border);
padding:4px 8px;
border-radius:8px;
font-size:12px;
cursor:pointer;
}

/* GRAFICO */
.chart-wrapper{
position:relative;
width:200px;
margin:auto;
}

canvas{
width:100%;
}

.percentage{
position:absolute;
top:50%;
left:50%;
transform:translate(-50%,-50%);
font-weight:bold;
font-size:18px;
}
</style>
</head>

<body>
<div class="container">

<h1>Weekly Tracker</h1>

<div class="card">
<input type="text" id="taskInput" placeholder="Nueva tarea">

<div class="time-display" id="timeDisplay">Seleccionar horario</div>

<div class="days-selector">
<label><input type="checkbox" value="monday"> Lunes</label>
<label><input type="checkbox" value="tuesday"> Martes</label>
<label><input type="checkbox" value="wednesday"> Miércoles</label>
<label><input type="checkbox" value="thursday"> Jueves</label>
<label><input type="checkbox" value="friday"> Viernes</label>
<label><input type="checkbox" value="saturday"> Sábado</label>
<label><input type="checkbox" value="sunday"> Domingo</label>
</div>

<button id="addTaskBtn">Agregar tarea</button>
</div>

<div class="card">
<div class="week-nav">
<div class="week-nav-top">
<button onclick="app.changeWeek(-1)">Anterior</button>
<button onclick="app.changeWeek(1)">Siguiente</button>
</div>
<div class="week-label" id="weekLabel"></div>
</div>
<div class="week" id="weekContainer"></div>
</div>

<div class="card">
<div class="chart-wrapper">
<canvas id="statsChart"></canvas>
<div class="percentage" id="percentage">0%</div>
</div>
</div>

</div>

<!-- MODAL -->
<div class="time-modal" id="timeModal">
<div class="time-picker">
<div class="time-columns">
<div class="time-column" id="hoursColumn"></div>
<div class="time-column" id="minutesColumn"></div>
</div>
<button id="confirmTimeBtn">Confirmar</button>
</div>
</div>

<script>
class App{
constructor(){
this.habits=JSON.parse(localStorage.getItem("habits"))||[];
this.progress=JSON.parse(localStorage.getItem("progress"))||{};
this.currentDate=new Date();

this.labels={
monday:"Lunes",tuesday:"Martes",wednesday:"Miércoles",
thursday:"Jueves",friday:"Viernes",
saturday:"Sábado",sunday:"Domingo"
};

this.selectedHour="";
this.selectedMinute="";
this.initTimePicker();

document.getElementById("addTaskBtn")
.addEventListener("click",()=>this.addHabit());

this.render();
}

initTimePicker(){
const modal=document.getElementById("timeModal");
const display=document.getElementById("timeDisplay");
const hoursCol=document.getElementById("hoursColumn");
const minutesCol=document.getElementById("minutesColumn");

for(let h=0;h<24;h++){
const hh=h.toString().padStart(2,"0");
hoursCol.innerHTML+=`<div class="time-item" data-hour="${hh}">${hh}</div>`;
}

for(let m=0;m<60;m++){
const mm=m.toString().padStart(2,"0");
minutesCol.innerHTML+=`<div class="time-item" data-minute="${mm}">${mm}</div>`;
}

display.addEventListener("click",()=>{
modal.style.display="flex";
});

modal.addEventListener("click",(e)=>{
if(e.target===modal) modal.style.display="none";
});

hoursCol.addEventListener("click",(e)=>{
if(e.target.classList.contains("time-item")){
hoursCol.querySelectorAll(".time-item").forEach(i=>i.classList.remove("active"));
e.target.classList.add("active");
this.selectedHour=e.target.dataset.hour;
}
});

minutesCol.addEventListener("click",(e)=>{
if(e.target.classList.contains("time-item")){
minutesCol.querySelectorAll(".time-item").forEach(i=>i.classList.remove("active"));
e.target.classList.add("active");
this.selectedMinute=e.target.dataset.minute;
}
});

document.getElementById("confirmTimeBtn")
.addEventListener("click",()=>{
if(this.selectedHour!=="" && this.selectedMinute!==""){
display.innerText=`${this.selectedHour}:${this.selectedMinute}`;
}
modal.style.display="none";
});
}

getWeekStart(date){
const d=new Date(date);
const day=d.getDay();
const diff=d.getDate()-((day+6)%7);
return new Date(d.setDate(diff));
}

getWeekKey(){
return this.getWeekStart(this.currentDate).toDateString();
}

changeWeek(offset){
this.currentDate.setDate(this.currentDate.getDate()+offset*7);
this.render();
}

save(){
localStorage.setItem("habits",JSON.stringify(this.habits));
localStorage.setItem("progress",JSON.stringify(this.progress));
}

addHabit(){
const text=document.getElementById("taskInput").value.trim();
if(!text)return;

const time=this.selectedHour && this.selectedMinute
? `${this.selectedHour}:${this.selectedMinute}`
: "";

const selected=[...document.querySelectorAll(".days-selector input:checked")];
if(selected.length===0)return;

const id=Date.now().toString();
const days=selected.map(cb=>cb.value);

this.habits.push({id,text,days,time});
this.save();
this.render();

document.getElementById("taskInput").value="";
this.selectedHour="";
this.selectedMinute="";
document.getElementById("timeDisplay").innerText="Seleccionar horario";

/* LIMPIAR SELECCION VISUAL */
document.querySelectorAll(".time-item")
.forEach(i=>i.classList.remove("active"));
}

deleteHabit(id){
this.habits=this.habits.filter(h=>h.id!==id);
this.save();
this.render();
}

setStatus(id,day,status){
const key=this.getWeekKey();
if(!this.progress[key])this.progress[key]={};
if(!this.progress[key][id])this.progress[key][id]={};
this.progress[key][id][day]=status;
this.save();
this.render();
}

getStatus(id,day){
const key=this.getWeekKey();
return this.progress?.[key]?.[id]?.[day]||"";
}

render(){
const start=this.getWeekStart(this.currentDate);
const end=new Date(start);
end.setDate(start.getDate()+6);

document.getElementById("weekLabel").innerText=
`${start.toLocaleDateString()} - ${end.toLocaleDateString()}`;

const container=document.getElementById("weekContainer");
container.innerHTML="";

Object.keys(this.labels).forEach(day=>{
const div=document.createElement("div");
div.className="day";
div.innerHTML=`<h3>${this.labels[day]}</h3>`;

this.habits
.filter(h=>h.days.includes(day))
.sort((a,b)=>(a.time||"").localeCompare(b.time||""))
.forEach(h=>{
const task=document.createElement("div");
task.className="task";

const status=this.getStatus(h.id,day);

task.innerHTML=`
<input type="checkbox" ${status==="done"?"checked":""}>
<span>${h.text}</span>
${h.time?`<span class="time-badge">${h.time}</span>`:""}
<button class="delete-btn">✕</button>
`;

task.querySelector("input")
.addEventListener("change",(e)=>{
this.setStatus(h.id,day,e.target.checked?"done":"");
});

task.querySelector(".delete-btn")
.addEventListener("click",()=>this.deleteHabit(h.id));

div.appendChild(task);
});

container.appendChild(div);
});

this.drawChart();
}

drawChart(){
const canvas=document.getElementById("statsChart");
const ctx=canvas.getContext("2d");
canvas.width=200;
canvas.height=200;
ctx.clearRect(0,0,200,200);

let done=0,total=0;
const key=this.getWeekKey();
const week=this.progress[key]||{};

Object.values(week).forEach(days=>{
Object.values(days).forEach(s=>{
if(s==="done")done++;
total++;
});
});

const percent=total?Math.round(done/total*100):0;
document.getElementById("percentage").innerText=percent+"%";

const angle=(percent/100)*Math.PI*2;

ctx.beginPath();
ctx.moveTo(100,100);
ctx.arc(100,100,90,0,angle);
ctx.fillStyle="#22c55e";
ctx.fill();

ctx.beginPath();
ctx.moveTo(100,100);
ctx.arc(100,100,90,angle,Math.PI*2);
ctx.fillStyle="#ef4444";
ctx.fill();
}
}

const app=new App();
</script>

</body>
</html>


